async function E(o,i={}){const c=i.hostModule,y={env:Object.assign(Object.create(globalThis),i.env||{},{abort(e,t,s,n){e=_(e>>>0),t=_(t>>>0),s=s>>>0,n=n>>>0,(()=>{throw Error(`${e} in ${t}:${s}:${n}`)})()}}),hostModule:Object.assign(Object.create(c),{postProgressMessage(e,t,s,n){e=e>>>0,t=t>>>0,s=s>>>0,n=n>>>0,c.postProgressMessage(e,t,s,n)}})},{exports:r}=await WebAssembly.instantiate(o,y),a=r.memory||i.env.memory,d=Object.setPrototypeOf({initialize(){return P(r.initialize()>>>0)},createImageObject(e,t){return r.createImageObject(e,t)>>>0},setImageObjectContent(e,t){t=w(Uint8ClampedArray,5,0,t)||C(),r.setImageObjectContent(e,t)},getImageObjectPtrLen(e){return g(t=>j(t)>>>0,2,r.getImageObjectPtrLen(e)>>>0)},getImageObjectWidthHeight(e){return g(t=>j(t)>>>0,2,r.getImageObjectWidthHeight(e)>>>0)}},r);function _(e){if(!e)return null;const t=e+new Uint32Array(a.buffer)[e-4>>>2]>>>1,s=new Uint16Array(a.buffer);let n=e>>>1,l="";for(;t-n>1024;)l+=String.fromCharCode(...s.subarray(n,n+=1024));return l+String.fromCharCode(...s.subarray(n,t))}function g(e,t,s){if(!s)return null;const n=j(s+4),l=f.getUint32(s+12,!0),b=new Array(l);for(let u=0;u<l;++u)b[u]=e(n+(u<<t>>>0));return b}function w(e,t,s,n){if(n==null)return 0;const l=n.length,b=r.__pin(r.__new(l<<s,1))>>>0,u=r.__new(12,t)>>>0;return S(u+0,b),f.setUint32(u+4,b,!0),f.setUint32(u+8,l<<s,!0),new e(a.buffer,b,l).set(n),r.__unpin(b),u}class A extends Number{}const O=new FinalizationRegistry(v);function P(e){if(!e)return null;const t=new A(m(e));return O.register(t,e),t}const h=new Map;function m(e){if(e){const t=h.get(e);t?h.set(e,t+1):h.set(r.__pin(e),1)}return e}function v(e){if(e){const t=h.get(e);if(t===1)r.__unpin(e),h.delete(e);else if(t)h.set(e,t-1);else throw Error(`invalid refcount '${t}' for reference '${e}'`)}}function C(){throw TypeError("value must not be null")}let f=new DataView(a.buffer);function S(e,t){try{f.setUint32(e,t,!0)}catch{f=new DataView(a.buffer),f.setUint32(e,t,!0)}}function j(e){try{return f.getUint32(e,!0)}catch{return f=new DataView(a.buffer),f.getUint32(e,!0)}}return d}var p=(o=>(o[o.create=0]="create",o[o.delete=1]="delete",o[o.transfer=2]="transfer",o))(p||{}),U=(o=>(o[o.applyAverageFilter=100]="applyAverageFilter",o))(U||{});WebAssembly.compileStreaming(fetch("../../../build/vite-react-promise-worker-assemblyscript-boilerplate/assets/index.asm")).then(o=>{E(o,{hostModule:{postProgressMessage(i,c,y,r){self.postMessage({type:U.applyAverageFilter,requestId:r,responsePayload:{id:i},progress:{value:c,valueMax:y}})}}}).then(i=>{self.addEventListener("message",c=>{const{type:y,requestId:r}=c.data;switch(y){case p.create:{const{width:a,height:d,buffer:_}=c.data.requestPayload,g=i.createImageObject(a,d),w=new Uint8ClampedArray(_);i.setImageObjectContent(g,w),self.postMessage({type:p.create,requestId:r,responsePayload:{id:g,width:a,height:d}});break}case U.applyAverageFilter:{const{id:a,iteration:d}=c.data.requestPayload;i.applyAverageFilter(a,d,r),self.postMessage({type:y,requestId:r,responsePayload:{id:a}});break}case p.transfer:{const{id:a}=c.data.requestPayload,[d,_]=i.getImageObjectWidthHeight(a),[g,w]=i.getImageObjectPtrLen(a),A=new Uint8ClampedArray(i.memory.buffer,g,w),O=Uint8ClampedArray.from(A);i.deleteImageObject(a),self.postMessage({type:p.transfer,requestId:r,responsePayload:{id:a,width:d,height:_,buffer:O.buffer}},[O.buffer]);break}default:throw new Error("unknown message:"+JSON.stringify(c.data))}})})});

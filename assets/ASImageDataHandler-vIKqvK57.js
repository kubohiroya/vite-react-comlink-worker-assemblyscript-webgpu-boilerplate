/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const x=Symbol("Comlink.proxy"),W=Symbol("Comlink.endpoint"),D=Symbol("Comlink.releaseProxy"),j=Symbol("Comlink.finalizer"),A=Symbol("Comlink.thrown"),R=e=>typeof e=="object"&&e!==null||typeof e=="function",H={canHandle:e=>R(e)&&e[x],serialize(e){const{port1:t,port2:r}=new MessageChannel;return T(e,t),[r,[r]]},deserialize(e){return e.start(),B(e)}},F={canHandle:e=>R(e)&&A in e,serialize({value:e}){let t;return e instanceof Error?t={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:t={isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},U=new Map([["proxy",H],["throw",F]]);function N(e,t){for(const r of e)if(t===r||r==="*"||r instanceof RegExp&&r.test(t))return!0;return!1}function T(e,t=globalThis,r=["*"]){t.addEventListener("message",function o(s){if(!s||!s.data)return;if(!N(r,s.origin)){console.warn(`Invalid origin '${s.origin}' for comlink proxy`);return}const{id:l,type:b,path:y}=Object.assign({path:[]},s.data),m=(s.data.argumentList||[]).map(w);let i;try{const f=y.slice(0,-1).reduce((c,n)=>c[n],e),g=y.reduce((c,n)=>c[n],e);switch(b){case"GET":i=g;break;case"SET":f[y.slice(-1)[0]]=w(s.data.value),i=!0;break;case"APPLY":i=g.apply(f,m);break;case"CONSTRUCT":{const c=new g(...m);i=K(c)}break;case"ENDPOINT":{const{port1:c,port2:n}=new MessageChannel;T(e,n),i=q(c,[c])}break;case"RELEASE":i=void 0;break;default:return}}catch(f){i={value:f,[A]:0}}Promise.resolve(i).catch(f=>({value:f,[A]:0})).then(f=>{const[g,c]=M(f);t.postMessage(Object.assign(Object.assign({},g),{id:l}),c),b==="RELEASE"&&(t.removeEventListener("message",o),z(t),j in e&&typeof e[j]=="function"&&e[j]())}).catch(f=>{const[g,c]=M({value:new TypeError("Unserializable return value"),[A]:0});t.postMessage(Object.assign(Object.assign({},g),{id:l}),c)})}),t.start&&t.start()}function V(e){return e.constructor.name==="MessagePort"}function z(e){V(e)&&e.close()}function B(e,t){const r=new Map;return e.addEventListener("message",function(s){const{data:l}=s;if(!l||!l.id)return;const b=r.get(l.id);if(b)try{b(l)}finally{r.delete(l.id)}}),k(e,r,[],t)}function O(e){if(e)throw new Error("Proxy has been released and is not useable")}function L(e){return h(e,new Map,{type:"RELEASE"}).then(()=>{z(e)})}const P=new WeakMap,S="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const t=(P.get(e)||0)-1;P.set(e,t),t===0&&L(e)});function $(e,t){const r=(P.get(t)||0)+1;P.set(t,r),S&&S.register(e,t,e)}function G(e){S&&S.unregister(e)}function k(e,t,r=[],o=function(){}){let s=!1;const l=new Proxy(o,{get(b,y){if(O(s),y===D)return()=>{G(l),L(e),t.clear(),s=!0};if(y==="then"){if(r.length===0)return{then:()=>l};const m=h(e,t,{type:"GET",path:r.map(i=>i.toString())}).then(w);return m.then.bind(m)}return k(e,t,[...r,y])},set(b,y,m){O(s);const[i,f]=M(m);return h(e,t,{type:"SET",path:[...r,y].map(g=>g.toString()),value:i},f).then(w)},apply(b,y,m){O(s);const i=r[r.length-1];if(i===W)return h(e,t,{type:"ENDPOINT"}).then(w);if(i==="bind")return k(e,t,r.slice(0,-1));const[f,g]=I(m);return h(e,t,{type:"APPLY",path:r.map(c=>c.toString()),argumentList:f},g).then(w)},construct(b,y){O(s);const[m,i]=I(y);return h(e,t,{type:"CONSTRUCT",path:r.map(f=>f.toString()),argumentList:m},i).then(w)}});return $(l,e),l}function Y(e){return Array.prototype.concat.apply([],e)}function I(e){const t=e.map(M);return[t.map(r=>r[0]),Y(t.map(r=>r[1]))]}const v=new WeakMap;function q(e,t){return v.set(e,t),e}function K(e){return Object.assign(e,{[x]:!0})}function M(e){for(const[t,r]of U)if(r.canHandle(e)){const[o,s]=r.serialize(e);return[{type:"HANDLER",name:t,value:o},s]}return[{type:"RAW",value:e},v.get(e)||[]]}function w(e){switch(e.type){case"HANDLER":return U.get(e.name).deserialize(e.value);case"RAW":return e.value}}function h(e,t,r,o){return new Promise(s=>{const l=X();t.set(l,s),e.start&&e.start(),e.postMessage(Object.assign({id:l},r),o)})}function X(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}async function J(e,t={}){const r={env:Object.assign(Object.create(globalThis),t.env||{},{abort(n,a,u,d){n=y(n>>>0),a=y(a>>>0),u=u>>>0,d=d>>>0,(()=>{throw Error(`${n} in ${a}:${u}:${d}`)})()},postProgressMessage(n,a,u){n=n>>>0,a=a>>>0,u=u>>>0,postProgressMessage(n,a,u)},"console.log"(n){n=y(n>>>0),console.log(n)}})},{exports:o}=await WebAssembly.instantiate(e,r),s=o.memory||t.env.memory,l=Object.setPrototypeOf({createASImageObject(n,a,u){return u=b(u)||f(),o.createASImageObject(n,a,u)>>>0},getImageObjectPtrLen(n){return m(a=>c(a)>>>0,2,o.getImageObjectPtrLen(n)>>>0)},getImageObjectWidthHeight(n){return m(a=>c(a)>>>0,2,o.getImageObjectWidthHeight(n)>>>0)},getImageObjectData(n){return i(Uint8ClampedArray,o.getImageObjectData(n)>>>0)}},o);function b(n){if(n==null)return 0;const a=o.__new(n.byteLength,1)>>>0;return new Uint8Array(s.buffer).set(new Uint8Array(n),a),a}function y(n){if(!n)return null;const a=n+new Uint32Array(s.buffer)[n-4>>>2]>>>1,u=new Uint16Array(s.buffer);let d=n>>>1,E="";for(;a-d>1024;)E+=String.fromCharCode(...u.subarray(d,d+=1024));return E+String.fromCharCode(...u.subarray(d,a))}function m(n,a,u){if(!u)return null;const d=c(u+4),E=g.getUint32(u+12,!0),C=new Array(E);for(let _=0;_<E;++_)C[_]=n(d+(_<<a>>>0));return C}function i(n,a){return a?new n(s.buffer,c(a+4),g.getUint32(a+8,!0)/n.BYTES_PER_ELEMENT).slice():null}function f(){throw TypeError("value must not be null")}let g=new DataView(s.buffer);function c(n){try{return g.getUint32(n,!0)}catch{return g=new DataView(s.buffer),g.getUint32(n,!0)}}return l}const{memory:Q,__new:oe,__pin:ie,__unpin:ce,__collect:le,__rtti_base:ue,createASImageObject:Z,getImageObjectPtrLen:ee,deleteImageObject:te,getImageObjectWidthHeight:fe,getImageObjectData:ge,applyAverageFilter:re,applyAverageFilterSIMD:ne}=await(async e=>J(await(async()=>typeof process<"u"&&process.versions!=null&&(process.versions.node!=null||process.versions.bun!=null)?globalThis.WebAssembly.compile(await(await Promise.resolve().then(function(){return ae})).readFile(e)):await globalThis.WebAssembly.compileStreaming(globalThis.fetch(e)))(),{}))(new URL("/vite-react-comlink-worker-assemblyscript-webgpu-boilerplate/assets/index-tbfK-rGW.wasm",import.meta.url));class p{id;static monitors=new Map;static{globalThis.postProgressMessage=function(t,r,o){const s=p.monitors.get(t);s&&s({value:r,valueMax:o})}}constructor(){}async initialize(t,r,o){this.id=Z(t,r,o)}async applyAverageFilter(t,r,o){p.monitors.set(this.id,o),r.simd?ne(this.id,t):re(this.id,t),p.monitors.delete(this.id)}async transfer(){const[t,r]=ee(this.id),o=new Uint8ClampedArray(Q.buffer,t,r);return te(this.id),o}close(){self.close()}}T(new p);var se=Object.freeze({__proto__:null,ASImageDataHandler:p});T(se);var ae=Object.freeze({__proto__:null});
